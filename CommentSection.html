<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Feedback & Appreciation</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f2f2f2;
    padding: 20px;
  }
  .container {
    max-width: 600px;
    margin: auto;
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }
  h2 {
    text-align: center;
  }
  textarea {
    width: 100%;
    height: 80px;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    resize: none;
  }
  button {
    margin-top: 10px;
    padding: 10px 16px;
    background: #007bff;
    color: #fff;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }
  button:hover {
    background: #0056c7;
  }
  .comment {
    margin-top: 15px;
    padding: 12px;
    background: #f9f9f9;
    border-radius: 6px;
    border: 1px solid #ddd;
  }
  .time {
    font-size: 12px;
    color: gray;
  }
  .delete-btn {
    background: red;
    color: #fff;
    border: none;
    padding: 6px 10px;
    border-radius: 5px;
    cursor: pointer;
    float: right;
  }
  .delete-btn:disabled {
    background: #aaa;
    cursor: not-allowed;
  }
</style>
</head>
<body>
<div class="container">
  <h2>Client Feedback & Testimonials</h2>
   <input id="userName" type="text" placeholder="Your Name" />
  <textarea id="commentInput" placeholder="Write your comment..."></textarea>
  <div class="row">
    <button id="postBtn">Post Comment</button>
  </div>

  <div id="commentList"></div>
</div>

<script>
const API_URL = "http://localhost:3000/send-email";

document.getElementById('postBtn').addEventListener('click', addComment);

function addComment() {
  const textEl = document.getElementById('commentInput');
  const userEl = document.getElementById('userName');
  const text = textEl.value.trim();
  const user = userEl.value.trim();
  if (!user) return alert('Please enter your name');
  if (!text) return alert('Please enter a comment');

  const commentObj = { user, text, time: Date.now() };
  const comments = JSON.parse(localStorage.getItem('comments') || '[]');
  comments.push(commentObj);
  localStorage.setItem('comments', JSON.stringify(comments));

  textEl.value = '';

  fetch(API_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username: user, comment: text })
  });

  loadComments();
}

function loadComments() {
  const comments = JSON.parse(localStorage.getItem('comments') || '[]');
  const list = document.getElementById('commentList');
  list.innerHTML = '';

  comments.forEach((comment, index) => {
    const diffHours = (Date.now() - comment.time) / (1000 * 60 * 60);
    const canDelete = diffHours < 12;

    const div = document.createElement('div');
    div.className = 'comment';
    div.innerHTML = `
      <strong>${comment.user}</strong>
      <p>${comment.text}</p>
      <span class="time">Posted: ${new Date(comment.time).toLocaleString()}</span>
    `;

    const delBtn = document.createElement('button');
    delBtn.className = 'delete-btn';
    delBtn.textContent = 'Delete';
    delBtn.disabled = !canDelete;
    delBtn.onclick = () => showConfirm(index);
    div.appendChild(delBtn);

    list.appendChild(div);
  });
}

function deleteComment(index) {
  const comments = JSON.parse(localStorage.getItem('comments') || '[]');
  comments.splice(index, 1);
  localStorage.setItem('comments', JSON.stringify(comments));
  loadComments();
}

function showConfirm(index){
  const box = document.createElement('div');
  box.style.position='fixed';
  box.style.top='0'; box.style.left='0';
  box.style.width='100%'; box.style.height='100%';
  box.style.background='rgba(0,0,0,0.4)';
  box.style.display='flex'; box.style.alignItems='center'; box.style.justifyContent='center';
  box.innerHTML = `
    <div style="background:white;padding:20px;border-radius:10px;max-width:320px;text-align:center;border:2px solid #ff4444;">
      <h3 style="color:#d8000c;">âš  Warning</h3>
      <p>Are you sure you want to delete this comment?</p>
      <button id="yesBtn" style="background:#d8000c;color:white;padding:8px 14px;margin-right:10px;">Yes</button>
      <button id="noBtn" style="background:#888;color:white;padding:8px 14px;">No</button>
    </div>`;
  document.body.appendChild(box);
  document.getElementById('yesBtn').onclick = () => { deleteComment(index); document.body.removeChild(box); };
  document.getElementById('noBtn').onclick = () => document.body.removeChild(box);
}

loadComments();
</script>
</body>
</html>
